syntax = "proto3";

option go_package = "./genproto/scoringpb";

// ================= SERVICE =================

service ScoringService {
  rpc GiveScore (GiveScoreRequest) returns (Score);
  rpc GetScoresByEvent (GetScoresByEventRequest) returns (ScoreList);
  rpc GetScoresByUser (GetScoresByUserRequest) returns (ScoreList);
  rpc GetScoresByTeam (GetScoresByTeamRequest) returns (ScoreList);
  rpc GetGlobalRanking (GetGlobalRankingRequest) returns (RankingList);
}

// ================= ENUMS =================

enum ScoredByType {
  ORGANIZER = 0;
  ADMIN = 1;
}

// ================= MODELS =================

message Score {
  string id = 1;
  string event_id = 2;
  string team_id = 3;            // student qaysi teamda
  string user_id = 4;            // kimga baho berilayapti
  int32 points = 5;
  string comment = 6;
  string scored_by_id = 7;       // kim berdi
  ScoredByType scored_by_type = 8;
  string created_at = 9;
}

// ================= REQUESTS =================

message GiveScoreRequest {
  string event_id = 1;
  string team_id = 2;
  string user_id = 3;            // har bir member uchun alohida yuboriladi
  int32 points = 4;
  string comment = 5;
  string scored_by_id = 6;
  ScoredByType scored_by_type = 7;
}

message GetScoresByEventRequest {
  string event_id = 1;
  int32 limit = 2;
  int32 page = 3;
}

message GetScoresByUserRequest {
  string user_id = 1;
  int32 limit = 2;
  int32 page = 3;
}

message GetScoresByTeamRequest {
  string team_id = 1;
  int32 limit = 2;
  int32 page = 3;
}

message GetGlobalRankingRequest {
  int32 limit = 1;
  int32 page = 2;
}

// ================= RESPONSES =================

message ScoreList {
  repeated Score scores = 1;
  int32 total_count = 2;
}

message Ranking {
  string user_id = 1;
  string user_name = 2;
  int32 total_points = 3;
  int32 rank = 4;
}

message RankingList {
  repeated Ranking rankings = 1;
  int32 total_count = 2;
}
