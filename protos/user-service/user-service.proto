syntax="proto3";

option go_package = "./genproto/userpb";

service UserService {
    rpc CreateUser (CreateUserRequest) returns (User);
    rpc GetUserByIdentifier(GetUserByIdentifierRequest) returns (LoginResponse);
    rpc GetUserById (GetUserByIdRequest) returns (User);
    rpc UpdateUser (UpdateUserRequest) returns (User);
    rpc ListUsers (ListUsersRequest) returns (UserList);
    rpc DeleteUser (DeleteUserRequest) returns (DeleteUserResponse);
    rpc ChangePassword (ChangePasswordRequest) returns (ChangePasswordResponse);

    // Role Types CRUD (Admin tomonidan)
    rpc CreateRole (CreateRoleRequest) returns (RoleType);
    rpc GetRoleById (GetRoleByIdRequest) returns (RoleType);
    rpc UpdateRole (UpdateRoleRequest) returns (RoleType);
    rpc DeleteRole (DeleteRoleRequest) returns (StatusResponse);
    rpc ListRoles (ListRolesRequest) returns (RoleTypeList);

    // User Roles CRUD (Admin tomonidan)
    rpc AssignRoleToUser (AssignRoleRequest) returns (UserRole);
    rpc RemoveRoleFromUser (RemoveRoleRequest) returns (StatusResponse);
    rpc ListUserRoles (ListUserRolesRequest) returns (UserRoleList);
}
  
service UserSessionService {
    rpc CreateSession (CreateSessionRequest) returns (UserSession);
    rpc GetSessionByToken (GetSessionByTokenRequest) returns (UserSession);
    rpc DeleteSession (DeleteSessionRequest) returns (StatusResponse);
}

message User {
    string id = 1;
    int32 identifier = 2;                     // 5 xonali login ID
    string first_name = 3;
    string last_name = 4;
    string phone_number = 5;
    string faculty = 6;
    int32 course = 7;
    string birth_date = 8;                    // YYYY-MM-DD formatda
    string gender = 9;                        // MALE / FEMALE
    string created_at = 10;
    string updated_at = 11;
}

message UserSession {
    string id = 1;
    string user_id = 2;
    string refresh_token = 3;
    string expires_at = 4;
    string created_at = 5;
}
  
message CreateUserRequest {
    int32 identifier = 1;
    string first_name = 2;
    string last_name = 3;
    string phone_number = 4;
    string password_hash = 5;
    string faculty = 6;
    int32 course = 7;
    string birth_date = 8;
    string gender = 9;
}

message GetUserByIdentifierRequest {
    int32 identifier = 1;
    string password = 2;
}

// Login response - to'liq user ma'lumoti va token
message LoginResponse {
    User user = 1;
    string access_token = 2;
    string refresh_token = 3;
}

message GetUserByIdRequest {
    string id = 1;
}

message UpdateUserRequest {
    string id = 1;
    string first_name = 2;
    string last_name = 3;
    string phone_number = 4;
    string faculty = 5;
    int32 course = 6;
    string birth_date = 7;
    string gender = 8;
}

message ChangePasswordRequest {
    string user_id = 1;
    string old_password = 2;
    string new_password = 3;
}

message ChangePasswordResponse {
    bool success = 1;
    string message = 2;
    string updated_at = 3;
}

message ListUsersRequest {
    string search = 1;  // ism, familiya yoki identifier bo'yicha qidirish
    string faculty = 2; // fakultet bo'yicha filter
    int32 course = 3;   // kurs bo'yicha filter
    int32 page = 4;
    int32 limit = 5;
}

message UserList {
    repeated User users = 1;
    int32 total_count = 2;
}

message DeleteUserRequest {
    string id = 1;
}

message DeleteUserResponse {
    bool success = 1;
    string message = 2;
    string deleted_user_id = 3;
    string deleted_at = 4;
}

// User Session Service
message CreateSessionRequest {
    string user_id = 1;
    string refresh_token = 2;
    string expires_at = 3;
}
  
message GetSessionByTokenRequest {
    string refresh_token = 1;
}

message DeleteSessionRequest {
    string refresh_token = 1;
}

// Roles 
message RoleType {
    string id = 1;
    string name = 2;          // ADMIN, ORGANIZER, STUDENT
    string description = 3;
    string created_at = 4;
    string updated_at = 5;
}

message CreateRoleRequest {
    string name = 1;
    string description = 2;
}

message UpdateRoleRequest {
    string id = 1;
    string name = 2;
    string description = 3;
}

message GetRoleByIdRequest {
    string id = 1;
}

message DeleteRoleRequest {
    string id = 1;
}

message ListRolesRequest {
    int32 page = 1;
    int32 limit = 2;
}

message RoleTypeList {
    repeated RoleType roles = 1;
    int32 total_count = 2;
}

// User roles
message UserRole {
    string id = 1;
    string user_id = 2;
    string role_id = 3;
    string role_name = 4;
    string assigned_at = 5;
}

message AssignRoleRequest {
    string user_id = 1;
    string role_id = 2;
}

message RemoveRoleRequest {
    string user_role_id = 1;
}

message ListUserRolesRequest {
    string user_id = 1;
    int32 page = 2;
    int32 limit = 3;
}

message UserRoleList {
    repeated UserRole user_roles = 1;
    int32 total_count = 2;
}

// Umumiy status response
message StatusResponse {
    bool success = 1;
    string message = 2;
}